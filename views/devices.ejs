<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Gerenciar Dispositivos</title>
    <link rel="stylesheet" href="/css/styles.css" />
  </head>
  <body class="dashboard">
    <%- include("partials/navbar") %>

    <main class="container">
      <div class="device-header">
        <button class="device-button" id="openDeviceModal">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
          <span>Novo Dispositivo</span>
        </button>
      </div>

      <div class="device-table-wrapper">
        <table class="device-table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>ID</th>
              <th>Segredo</th>
              <th>Status</th>
              <th>Último Acesso</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <% devices.forEach(device => { %>
            <tr>
              <td><%= device.name %></td>
              <td><%= device.device_id %></td>
              <td><%= device.device_secret %></td>
              <td><%= device.active ? 'Ativo' : 'Inativo' %></td>
              <td>
                <%= device.last_seen ? device.last_seen.toLocaleString() :
                'Nunca' %>
              </td>
              <td>
                <form
                  method="POST"
                  action="/devices/<%= device.id %>/<%= device.active ? 'deactivate' : 'activate' %>"
                >
                  <button
                    type="submit"
                    class="action-icon <%= device.active ? 'action-red' : 'action-green' %>"
                  >
                    <% if (device.active) { %>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="#ef4444"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M18 6L6 18" />
                      <path d="M6 6l12 12" />
                    </svg>
                    <% } else { %>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="#00c86f"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <circle cx="12" cy="12" r="10" />
                      <line x1="12" y1="8" x2="12" y2="16" />
                      <line x1="8" y1="12" x2="16" y2="12" />
                    </svg>
                    <% } %>
                  </button>
                </form>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </main>

    <div id="deviceModal" class="modal-overlay">
      <div class="modal-card">
        <div class="modal-header">
          <h3 class="modal-title">Novo Dispositivo</h3>
          <button id="closeDeviceModal" class="modal-close">&times;</button>
        </div>
        <form action="/devices" method="POST" class="modal-form">
          <input
            type="text"
            name="name"
            placeholder="Nome do Dispositivo"
            required
            class="modal-input"
          />
          <button type="submit" class="device-button">
            <span class="button-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M12 5v14M5 12h14" />
              </svg>
            </span>
            <span class="button-text">Adicionar</span>
          </button>
        </form>
      </div>
    </div>

    <%- include("partials/footer") %>
    <script src="/js/devices.js"></script>
  </body>
</html>
